# Progress Tracker
# Ralphie appends completed tasks here after each iteration.
# This file helps Ralphie understand what's been done and what's next.

✅ 2026-01-12: Added AskUserQuestion protocol for SPEC creation
  - Added "Creating SPECs (Interactive)" section to templates/.claude/ralph.md
  - Defined 3 question batches: technical foundation, feature scope, quality gates
  - Included example AskUserQuestion call with structured options
  - Documented interview flow from questions to SPEC generation
  - Commit: 12064c5 docs(ralph): add AskUserQuestion protocol for SPEC creation interviews

✅ 2026-01-12: Added Task(Explore) protocol for parallel codebase exploration
  - Added step 2 to Planning Phase: spawn exploration agents if needed
  - Added detailed Task(Explore) Protocol section with:
    - When to explore vs skip guidance
    - Example parallel agent spawning code
    - What to explore (architecture, patterns, dependencies, conventions)
    - How to use exploration results in planning
  - Commit: 953b42c docs(ralph): add Task(Explore) protocol for parallel codebase exploration

✅ 2026-01-12: Added code review protocol for pre-commit agent review
  - Added "Code Review Protocol" section after "Task Completion Criteria"
  - Documents when to review (after tests, before commit) vs skip (docs-only, config)
  - Task agent example with structured review prompt (bugs, tests, patterns, security, performance)
  - Handling feedback table: CRITICAL (fix), SUGGESTIONS (optional), APPROVED (commit)
  - Example review flow from implementation to commit
  - Commit: 81f9433 docs(ralph): add code review protocol for pre-commit agent review

✅ 2026-01-12: Added TodoWrite protocol for sub-task tracking
  - Added "Sub-Task Tracking Protocol" section after "Code Review Protocol"
  - Documents when to use TodoWrite (3+ steps) vs skip (atomic tasks)
  - TodoWrite structure: content, activeForm, status fields
  - Example breaking down auth feature into 5 trackable sub-tasks
  - Workflow: start with sub-tasks, track progress, complete before commit
  - Integration diagram showing SPEC task → sub-tasks → commit flow
  - Commit: 81b8407 docs(ralph): add TodoWrite protocol for sub-task tracking

✅ 2026-01-12: Created /ralph-iterate skill with frontmatter
  - Created .claude/skills/ralph-iterate/SKILL.md
  - Frontmatter: name, description, context: fork, allowed-tools
  - Skill body includes 6-step iteration protocol (Load Context, Explore, Plan, Implement, Review, Commit)
  - Commit: d867cb4 feat(skill): create ralph-iterate skill with frontmatter

✅ 2026-01-12: Enhanced Load Context step with detailed TodoWrite guidance
  - Added 4 sub-sections: SPEC.md reading, STATE.txt checks, index.md reading, TodoWrite
  - Included explicit TodoWrite example with content, activeForm, status fields
  - Documented when to skip TodoWrite (atomic tasks, docs-only, <3 steps)
  - Commit: 6c6645a docs(skill): enhance Load Context step with detailed TodoWrite guidance

✅ 2026-01-12: Enhanced Explore step with parallel agent guidance
  - Added 4 sub-sections: when to explore, spawn parallel agents, what to explore, using results
  - Included example with 3 concurrent Task(Explore) calls for auth feature
  - Added table of exploration prompts by need (architecture, patterns, dependencies, conventions)
  - Documented 5-step workflow for incorporating exploration results
  - Commit: 424eba4 docs(skill): enhance Explore step with parallel agent guidance

✅ 2026-01-12: Enhanced Plan step with detailed guidance for writing plan.md
  - Added 4 sub-sections: Write the Goal, List the Files, Define the Tests, Set Exit Criteria
  - Included good/bad goal examples showing specific vs vague goals
  - Complete plan template with JWT token refresh example
  - Post-planning workflow (review scope, update TodoWrite, proceed to implementation)
  - Commit: 1125a3a docs(skill): enhance Plan step with detailed guidance for writing plan.md

✅ 2026-01-12: Enhanced Implement step with detailed code and test guidance
  - Added 5 sub-sections: Write the Code, Write the Tests, Run Tests, Run Type Check, Handle Failures
  - TodoWrite status updates at each stage of implementation
  - Implementation checklist for pre-review verification
  - Common type errors table with fixes
  - Commit: 9ba6886 docs(skill): enhance Implement step with detailed code and test guidance

✅ 2026-01-12: Enhanced Review step with detailed code review guidance
  - Added 5 sub-sections: When to Review, Spawn Review Agent, Handle Review Feedback, Review Flow Example, Update TodoWrite
  - Detailed review agent prompt with 5-point checklist (bugs, tests, patterns, security, performance)
  - Handling table for CRITICAL/SUGGESTIONS/APPROVED responses
  - Re-review flow for addressing critical issues
  - Visual review flow diagram showing decision points
  - Commit: a4f96a6 docs(skill): enhance Review step with detailed code review guidance

✅ 2026-01-12: Enhanced Commit step with detailed git and tracking guidance
  - Added 6 sub-sections: Stage Changes, Commit Message, Update index.md, Update SPEC.md, Update STATE.txt, Update TodoWrite
  - HEREDOC example for proper multi-line commit messages
  - Commit types table (feat, fix, refactor, test, docs, chore)
  - index.md entry format with SHA, files, tests, notes, next fields
  - Commit flow diagram showing complete workflow
  - Commit checklist for verifying iteration completion
  - Commit: 51535df docs(skill): enhance Commit step with detailed git and tracking guidance

✅ 2026-01-12: Created validate-iteration.md prompt for Stop hook
  - Created scripts/validate-iteration.md with LLM validation prompt
  - 7-point checklist: task, tests, types, commit, index, spec, state
  - JSON output format with valid/invalid status and issues array
  - Example outputs for common scenarios (valid, failed tests, no commit)
  - Special case handling for docs-only, non-TypeScript, partial tasks
  - Commit: d0a1824 docs(hooks): add validate-iteration.md prompt for Stop hook

✅ 2026-01-12: Added settings.json.example with Stop hook configuration
  - Created templates/.claude/settings.json.example
  - Stop hook with type: prompt pointing to scripts/validate-iteration.md
  - Common Ralph permission patterns (npm test, vitest, git commands)
  - Commit: 1fc21e0 docs(hooks): add settings.json.example with Stop hook configuration

✅ 2026-01-12: Added Hooks Configuration section to ralph.md
  - New "Hooks Configuration" section after "Error Recovery"
  - Documents Stop hook purpose and settings.json setup
  - Explains 7-point validation checklist and JSON output format
  - Includes troubleshooting table for common validation failures
  - Commit: b51ebad docs(hooks): add Hooks Configuration section to ralph.md

✅ 2026-01-12: Synced templates/.claude/ralph.md with .claude/CLAUDE.md
  - Added 11 sections from CLAUDE.md for template consistency
  - Comment examples, test structure, file organization, commit examples
  - Performance considerations, auth/auth, dependencies sections
  - Code review checklist, expanded anti-patterns, tools/linters
  - Added 6th philosophical principle (Documented over undocumented)
  - Commit: 10e84d2 docs(ralph): sync ralph.md with CLAUDE.md for template consistency

✅ 2026-01-12: Added Claude Code Native Features overview section
  - Table summarizing 5 key integrations (AskUserQuestion, Task agents, TodoWrite, Stop hook)
  - Workflow diagram showing how features work together in iteration loop
  - Placed after Required Reading, before detailed protocol sections
  - Commit: eb573dd docs(ralph): add Claude Code Native Features overview section

✅ 2026-01-12: Added ralph-iterate skill to templates for init command
  - Copied .claude/skills/ralph-iterate/SKILL.md to templates
  - Init command already does recursive copying, no code changes needed
  - Tests: 542 passing (no regressions)
  - Commit: 8ec2754 feat(init): add ralph-iterate skill to templates

✅ 2026-01-12: Added Phase 1 - headless flag and event emitter
  - Created src/lib/headless-emitter.ts with RalphEvent types (9 event kinds)
  - Added --headless flag to CLI run command
  - Added executeHeadlessRun placeholder (full implementation in Phase 2)
  - Wired conditional: headless skips Ink UI, uses JSON stdout
  - Tests: 555 passing (13 new tests for headless-emitter)
  - Commit: da3e6ec feat(headless): add Phase 1 - headless flag and event emitter

✅ 2026-01-12: Added Phase 2 - headless runner
  - Created src/lib/headless-runner.ts with executeHeadlessRun() and runSingleIteration()
  - Re-uses StreamParser and StateMachine for tool tracking and event parsing
  - Emits JSON events via headless-emitter (started, iteration, tool, commit, task_complete, iteration_done, stuck, complete, failed)
  - Tracks task completion by comparing SPEC.md before/after each iteration
  - Stuck detection: exits with code 1 after N iterations without task progress
  - Exit codes: 0=complete, 1=stuck, 2=max iterations, 3=error
  - Added --stuck-threshold CLI option (default 3)
  - Wired executeHeadlessRun in CLI to call headless runner
  - Tests: 577 passing (22 new tests for headless-runner)

✅ 2026-01-12: Completed Phase 3, 4, 5 - stuck detection, exit codes, tests verified
  - Phase 3 (stuck detection) was already implemented in Phase 2 entry
  - Phase 4 (exit codes) was already implemented in Phase 2 entry
  - Phase 5 (tests) were already written: 13 tests for headless-emitter, 22 tests for headless-runner
  - Fixed TypeScript type error in headless-runner.test.ts (Readable stream type for mock stdout/stderr)
  - Tests: 577 passing, type check passes
  - All v0.3 headless mode phases complete


✅ 2026-01-15: Migrated skills to skills/ directory for add-skill compatibility
  - Created skills/create-spec/SKILL.md and skills/ralph-iterate/SKILL.md
  - Skills have correct add-skill frontmatter format (name, description, context, allowed-tools)
  - Maintained backward compatibility - .claude/skills/ files remain unchanged
  - Tests: 590 passing, type check passes
  - Commit: 67a5fff feat(skills): migrate skills to skills/ directory for add-skill compatibility

✅ 2026-01-15: Created review-spec skill for SPEC validation
  - Created skills/review-spec/SKILL.md with comprehensive validation logic
  - Format checks: checkbox syntax, no code snippets, no file paths, deliverable sub-bullets, task batching
  - Content critique: problem-solution fit, integration awareness, scalability, scope appropriateness
  - Output format: PASS/FAIL with prioritized concerns (HIGH/MEDIUM/LOW) and actionable recommendations
  - Tests: 590 passing, type check passes
  - Commit: 88b9966 feat(skills): create review-spec skill for SPEC validation

✅ 2026-01-15: Created verify skill for pre-commit verification
  - Created skills/verify/SKILL.md with auto-detection logic
  - Detects project type from config files (package.json, tsconfig.json, pyproject.toml, etc.)
  - Zero configuration - Claude figures out what to run from context
  - Runs tests, type checking, and linting based on available tools
  - Supports TypeScript, Python, Go, Rust, Ruby projects
  - Clear PASS/FAIL/ERROR reporting with actionable details
  - Integration examples for Ralph iteration workflow
  - Tests: 590 passing, type check passes
  - Commit: 53ab3b7 feat(skills): create verify skill for pre-commit verification

✅ 2026-01-15: Updated ralph spec command to support interactive mode
  - Modified src/lib/spec-generator.ts to use /create-spec skill in interactive mode
  - Interactive mode (default): Uses skill with AskUserQuestion for structured interviews
  - Headless mode: Uses embedded prompt for autonomous generation
  - Created tests/lib/spec-generator.test.ts with 3 comprehensive tests
  - Tests mock process.stdin and child_process.spawn for isolated testing
  - Tests: 593 passing (3 new), type check passes
  - Commit: f332846 feat(spec): add interactive mode with create-spec skill

✅ 2026-01-15: Added autonomous spec mode with review loop
  - Added --auto and --max-attempts flags to ralph spec command
  - Created generateSpecAutonomous() function with review loop in spec-generator.ts
  - Implemented runReviewSpec() to invoke /review-spec skill and parse output
  - Implemented parseReviewOutput() to extract PASS/FAIL and concerns from review
  - Implemented refineSpec() to regenerate spec based on review feedback
  - Review loop runs up to maxAttempts (default 3) until PASS or max reached
  - Exit codes: 0 on success, 1 on max attempts without passing review
  - Added 4 comprehensive tests for autonomous mode (review success, refinement, max attempts, parsing)
  - Tests: 597 passing (4 new), type check passes
  - Commit: 665cb20 feat(spec): add autonomous mode with review loop

✅ 2026-01-15: Created harness abstraction layer for multi-AI support
  - Created src/lib/harness/types.ts with Harness interface (runSkill, spawn methods)
  - Created src/lib/harness/claude-code-harness.ts - ClaudeCodeHarness implementation
  - Created src/lib/harness/index.ts - Factory function (createHarness)
  - Created src/lib/config-loader.ts - Config loading from .ralph/config.yml
  - Added --harness CLI flag to run command in src/cli.tsx
  - Configuration priority: CLI flag > env (RALPH_HARNESS) > config file > default (claude-code)
  - Tests: 617 passing (17 new: 6 harness, 11 config-loader, 3 factory)
  - Commit: fcb141c feat(harness): add harness abstraction layer for multi-AI support

✅ 2026-01-19: Migrated App.tsx to V2 spec parser (T001-T003)
  - Created getTaskForIterationV2 function in src/lib/spec-parser-v2.ts
  - Returns first pending/in_progress task in V1-compatible shape
  - Function ignores iteration parameter (V2 uses task IDs, not iteration numbers)
  - Added 6 unit tests for getTaskForIterationV2 in tests/spec-parser-v2.test.ts
  - Updated src/App.tsx IterationRunner to use V2 functions:
    - locateActiveSpec() to find spec in specs/active/
    - parseSpecV2() instead of loadSpecFromDir()
    - isSpecCompleteV2() instead of isSpecComplete()
    - getTaskForIterationV2() instead of getTaskForIteration()
  - Added legacy format handling (logs warning, continues without spec)
  - Tests: 677 passing (6 new for getTaskForIterationV2)
  - Type check passes
  - Commit: 521e541 feat: T001-T003 migrate App.tsx to V2 spec parser

✅ 2026-01-19: Updated T004 status - IterationRunner spec loading (T004)
  - T004 work was already completed in T001-T003 batch commit
  - Verified all deliverables present in src/App.tsx:
    - IterationRunner uses locateActiveSpec(cwd) + parseSpecV2() (lines 262-263)
    - ParseResult stored and handled correctly (lines 263-270)
    - LegacySpecWarning handled: logs warning, sets spec to null (lines 267-269)
    - useEffect uses locateActiveSpec for spec path resolution (line 262)
    - Completion check uses isSpecCompleteV2(specPath) (line 289)
  - Tests: 677 passing, type check passes
  - Commit: 4c781dd feat: T004 update IterationRunner spec loading

✅ 2026-01-19: Updated T005 status - IterationRunner task retrieval (T005)
  - T005 work was already completed in T001-T003 batch commit
  - Verified all deliverables present in src/App.tsx:
    - Uses getTaskForIterationV2(spec, currentIteration) (line 433)
    - Handles null spec case with ternary operator (line 433)
    - Type is SpecV2 | null (line 257)
    - currentTask?.taskNumber, phaseName, taskText all work (lines 449-451)
  - Tests: 677 passing, type check passes
  - Commit: 0402e9d feat: T005 update IterationRunner task retrieval

✅ 2026-01-19: Updated tracking files for T004-T005
  - Committed STATE.txt and .ai/ralphie/index.md updates for T004 and T005
  - Both tasks were completed in previous commits (4c781dd, 0402e9d)
  - Tracking files document the completion of those tasks
  - Commit: bd50617 docs: update tracking files for T004-T005

✅ 2026-01-19: Completed T006-T007 - Legacy spec warning and integration tests
  - T006: Added legacySpecWarning state in IterationRunner, flows to App and AppInner
  - T006: Renders yellow warning banner "⚠ Legacy SPEC format - upgrade recommended"
  - T006: Console warning already exists, UI warning now visible to user
  - T007: Added 5 integration tests in tests/App.test.tsx
  - T007: Tests verify legacy warning display, task number rendering, null spec handling
  - Tests: 682 passing (5 new), type check passes
  - Commit: e402e86 feat: T006-T007 add legacy spec warning and integration tests

✅ 2026-01-19: Completed T008 - Manual E2E testing
  - Verified V2 spec integration in interactive UI through code review
  - Confirmed IterationRunner uses locateActiveSpec/parseSpecV2/getTaskForIterationV2
  - Verified task ID (taskNumber) flows to UI components correctly
  - Verified legacy spec warning displays when V1 format detected
  - Verified completion detection via isSpecCompleteV2
  - Tests: 682 passing, type check passes
  - All 8 tasks in app-v2-migration spec now complete
  - Commit: a559c84 test: T008 verify V2 spec integration in interactive UI

✅ 2026-01-19: Completed T001 - Extract failure context helpers (component-refactor spec)
  - Created src/lib/failure-context.ts with buildFailureContext and formatToolInput functions
  - Moved helper functions from App.tsx to dedicated module (lines 22-58 removed from App.tsx)
  - Removed unused imports: FailureContext, ActivityItem, ToolGroup from App.tsx
  - Added JSDoc comments to exported functions for better documentation
  - App.tsx now imports buildFailureContext from new module
  - Tests: 682 passing, type check passes
  - Pure refactor - no behavior changes
  - Commit: ed4abcd feat: T001 extract failure context helpers

✅ 2026-01-19: Completed T002 - Extract IterationView component (component-refactor spec)
  - Created src/components/IterationView.tsx with AppInner component renamed to IterationView
  - Exported IterationViewProps interface (formerly AppInnerProps) for type safety
  - Moved complete component logic including useEffect hook for iteration completion
  - App.tsx now imports and uses IterationView instead of local AppInner component
  - Removed AppInnerProps interface from App.tsx (now in IterationView.tsx)
  - Cleaned up unused imports: StatusMessage, individual component imports moved to IterationView
  - Added JSDoc comment to IterationView component explaining its purpose
  - Tests: 682 passing, type check passes
  - Pure refactor - no behavior changes
  - Commit: dfa584d feat: T002 extract IterationView component

✅ 2026-01-19: Completed T003 - Extract IterationRunner component (component-refactor spec)
  - Created src/IterationRunner.tsx with IterationRunner component and orchestration logic
  - Moved helper functions formatDuration and aggregateStats to new file
  - Exported IterationRunnerProps interface from new file
  - App.tsx now re-exports IterationRunner and IterationView for backward compatibility
  - App.tsx reduced from 334 lines to 72 lines (78% reduction) - well under 100-line target
  - Removed unused imports: useState, useEffect, useCallback, useApp, Box, Text, spec-parser-v2, spec-locator
  - Added JSDoc comment to IterationRunner explaining its purpose
  - IterationRunner handles: spec loading, iteration orchestration, completion detection, summary display
  - Tests: 682 passing, type check passes
  - Pure refactor - no behavior changes
  - Achieves acceptance criteria: App.tsx under 100 lines
  - Commit: 1bc8a46 feat: T003 extract IterationRunner component

✅ 2026-01-19: Completed T004 - Extract prompt constants (component-refactor spec)
  - Created src/lib/prompts.ts with DEFAULT_PROMPT and GREEDY_PROMPT exports
  - Moved 80 lines of prompt constants from cli.tsx to dedicated module
  - Updated cli.tsx to import from './lib/prompts.js'
  - Updated tests/cli.test.tsx to import from '../src/lib/prompts.js'
  - Tests: 682 passing, type check passes
  - Pure refactor - no behavior changes
  - Improves code organization and maintainability
  - Commit: 2e616a7 feat: T004 extract prompt constants

✅ 2026-01-19: Completed T005 - Extract interactive run command (component-refactor spec)
  - Created src/commands/run-interactive.tsx with executeRun function
  - Moved 54 lines of interactive run logic from cli.tsx to dedicated module
  - Function handles: project validation, feature branch creation, prompt resolution, Ink UI rendering, signal handling
  - Removed unused imports from cli.tsx: React, render, IterationRunner, createFeatureBranch, getSpecTitleV2
  - Tests: 682 passing, type check passes
  - Pure refactor - no behavior changes
  - Improves separation of concerns between CLI parsing and command execution
  - Commit: 9f0c117 feat: T005 extract interactive run command

✅ 2026-01-19: Completed T006 - Verify all tests pass (component-refactor spec)
  - Ran full test suite with `npm test`
  - All 613 tests passed with no failures or regressions
  - Verified import paths working correctly with refactored module structure
  - Confirmed no behavior changes from refactoring tasks T001-T005
  - Test output clean with no unexpected errors or warnings
  - Component refactor spec now complete - all 6 tasks passed
  - Commit: ce3465b test: T006 verify all tests pass after refactoring

✅ 2026-01-21: Completed T001 - Restructure to .ralphie/ folder (compound-learnings spec)
  - Created comprehensive .ralphie/ directory structure:
    - .ralphie/specs/ (active, completed, templates)
    - .ralphie/learnings/ (build-errors, test-failures, runtime-errors, patterns)
    - .ralphie/state.txt (moved from root STATE.txt)
    - .ralphie/llms.txt (new architecture decisions file)
  - Created global ~/.ralphie/ directory:
    - ~/.ralphie/learnings/ (shared across projects)
    - ~/.ralphie/settings.json (global defaults)
  - Created src/lib/paths.ts with centralized path utilities
  - Updated src/lib/spec-locator.ts to use paths module
  - Updated src/commands/init.ts to create new structure and global directory
  - Updated src/lib/prompts.ts to reference .ralphie/ paths
  - Created MIGRATION.md guide for AI-assisted migration
  - Backward compatibility: detects old specs/ structure and shows migration message
  - Updated templates/ to use .ralphie/ structure
  - Updated all tests (18 new tests for paths module)
  - Tests: 637 passing (all tests pass)
  - Verified: `ralphie init` creates correct structure and global directory
  - Commit: dbf445d feat: T001 restructure to .ralphie/ folder

# Code Quality Validation Test Suite

This test suite validates that Ralphie generates senior engineer-level code that meets professional quality standards.

## Overview

The code quality validation suite ensures that code generated by Ralphie meets the following criteria:

- ✅ Uses best-in-class libraries for the problem domain
- ✅ Proper separation of concerns (routes, services, models, etc.)
- ✅ Typed interfaces and contracts between modules
- ✅ Comprehensive tests included (>80% coverage)
- ✅ No security vulnerabilities
- ✅ Would pass senior engineer code review

## Test Files

### `test-helpers.ts`
Shared utility functions for quality validation:
- File pattern matching
- TypeScript interface detection
- Separation of concerns checking
- Test file detection
- Security pattern analysis
- Dependency validation

### `typescript-auth.test.ts`
Validates TypeScript authentication feature generation:
- Uses recommended libraries (Passport.js, JWT, bcrypt)
- Proper file separation (routes, services, models)
- TypeScript interfaces for contracts
- Tests included
- No security issues (password hashing, JWT expiration, etc.)

### `python-validation.test.ts`
Validates Python validation code generation:
- Uses Pydantic for data validation
- Type hints on all functions and classes
- Tests with pytest
- Custom validators for business logic
- Proper error messages

### `bad-code-improvement.test.ts`
Validates that Ralphie improves existing bad code:
- Doesn't copy tech debt (TODOs, FIXMEs, any types)
- Improves architecture (separation of concerns)
- Uses better patterns (async/await, functional)
- Adds missing error handling
- Includes tests

### `index.test.ts`
Master test file that documents:
- Overall quality standards
- Senior engineer criteria
- Library recommendations by use case
- Test coverage requirements
- Documentation standards

## Running the Tests

### Run all code quality tests:
```bash
npm test -- code-quality
```

### Run a specific test file:
```bash
npm test -- typescript-auth
npm test -- python-validation
npm test -- bad-code-improvement
```

### Run all tests with coverage:
```bash
npm run test:coverage
```

## Quality Standards

### Architecture
- **Separation of Concerns**: Business logic, data access, and presentation layers separated
- **Single Responsibility**: Each module/class has one clear purpose
- **Dependency Injection**: Dependencies passed in, not hard-coded
- **Clear Boundaries**: Well-defined interfaces between modules

### Type Safety
- **Explicit Types**: All parameters and return values typed
- **No any**: Use proper types, never `any`
- **Interfaces**: Define contracts between modules
- **Type Guards**: Runtime type checking where needed

### Testing
- **Unit Tests**: All business logic tested
- **>80% Coverage**: Minimum coverage threshold
- **Edge Cases**: Boundary conditions tested
- **Integration Tests**: API endpoints and database operations tested

### Security
- **Input Validation**: All user input validated
- **Parameterized Queries**: No SQL injection risks
- **No Hardcoded Secrets**: Use environment variables
- **Secure Defaults**: HTTPS, httpOnly cookies, password hashing

### Tooling
- **Best-in-Class**: Use well-maintained, popular libraries
- **Appropriate**: Match tool to problem domain
- **Type-Safe**: Prefer libraries with TypeScript support
- **Well-Documented**: Good documentation and examples

## Library Recommendations

### TypeScript
- **Validation**: Zod, Yup, Joi
- **Authentication**: Passport.js, jsonwebtoken, bcrypt
- **Testing**: Vitest, Jest, Playwright
- **Database**: Prisma, Drizzle, TypeORM
- **API**: Express, Fastify, Hono

### Python
- **Validation**: Pydantic, Marshmallow
- **Authentication**: PyJWT, Passlib, python-jose
- **Testing**: pytest, pytest-cov, hypothesis
- **Database**: SQLAlchemy, Alembic
- **API**: FastAPI, Django Ninja

## How to Use This Suite

### During Development
1. Generate code with Ralphie
2. Run quality validation: `npm test -- code-quality`
3. Review any failures
4. Iterate to meet quality standards

### In CI/CD
Add to your pipeline:
```yaml
- name: Validate Code Quality
  run: npm test -- code-quality
```

### Before Release
1. Run full test suite
2. Verify all quality checks pass
3. Review generated code manually
4. Ensure documentation is complete

## Interpreting Results

### All Tests Pass ✅
Generated code meets senior engineer quality standards. Ready to review and merge.

### Some Tests Fail ❌
Review the failure details:
- **Library Choice**: Is the best library being used?
- **Separation**: Is code properly organized?
- **Types**: Are interfaces defined?
- **Tests**: Are tests included and comprehensive?
- **Security**: Are there security issues?

### Improving Quality
If tests fail, consider:
1. Update prompts to emphasize quality standards
2. Add explicit library recommendations
3. Enhance research phase to find better tools
4. Strengthen review phase to catch issues

## Future Enhancements

### Planned
- [ ] Run against real generated code projects
- [ ] Add more language support (Rust, Go, etc.)
- [ ] Performance benchmarking
- [ ] Automated quality scoring
- [ ] Trend analysis over time

### Ideas
- Integration with code review tools
- Quality metrics dashboard
- Comparative analysis vs industry standards
- AI-powered quality suggestions

## Contributing

When adding new quality checks:

1. **Document Expectations**: Clearly define what "good" looks like
2. **Provide Examples**: Show good vs bad code
3. **Make it Testable**: Write checks that can run programmatically
4. **Keep it Practical**: Focus on impactful quality measures
5. **Include Rationale**: Explain why each standard matters

## References

- [Senior Engineer Code Quality Standards](../../docs/code-quality-standards.md)
- [Ralphie Documentation](../../README.md)
- [Vitest Documentation](https://vitest.dev/)

---

**Last Updated**: 2026-01-22
**Maintained By**: Ralphie Team
